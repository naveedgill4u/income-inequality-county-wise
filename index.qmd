---
title: "Income Inequality in U.S"
execute: 
  echo: false
---

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(tidycensus)
library(GGally)
library(ggplot2)
library(ggthemes)
library(tidymodels)
library(marginaleffects)
library(broom)
library(plotly)
```

```{r}
#| warning: false
multi_vars <- c(
  gini = "B19083_001",
  median_income = "B19013_001",
  poverty = "B17001_002",                    # Below poverty
  education_total = "B15003_001",           # Total population 25+
  education_bachelor = "B15003_022",        # Bachelor's degree
  labor_force = "B23025_003",               # Labor force
  unemployed = "B23025_005")                # Unemployed

socio_data <- get_acs(
  geography = "county",
  variables = multi_vars,
  year = 2020,
  survey = "acs5",
  output = "wide")

# Clean and calculate additional metrics
socio_clean <- socio_data |>
  transmute(
    GEOID = GEOID,
    county = NAME,
    gini = giniE,
    income = median_incomeE / 100000,
    poverty = povertyE / 100000,
    education_rate = education_bachelorE / education_totalE,
    unemployment_rate = unemployedE / labor_forceE) |>
    select(GEOID, county, gini, income ,poverty, unemployment_rate )
```

```{r}
income_inequality <- linear_reg() |> 
   fit(gini ~ income + poverty + unemployment_rate, data = socio_clean)
```

```{r}
# 2. Create predictions with county names
pred_data <- socio_clean |>
  bind_cols(
    predict(income_inequality, new_data = socio_clean),
    predict(income_inequality, new_data = socio_clean, type = "conf_int")
  ) |>
  rename(.fitted = .pred, .lower = .pred_lower, .upper = .pred_upper)
```

```{r}
# 3. Create interactive plot (now with county names)
plot_interactive <- pred_data |> 
  ggplot(aes(
    x = .fitted, 
    y = gini,
    color = unemployment_rate,
    text = paste(
      "County:", county,
      "<br>Predicted Gini:", round(.fitted, 3),
      "<br>Actual Gini:", round(gini, 3),
      "<br>Unemployment:", scales::percent(unemployment_rate, accuracy = 0.1),
      "<br>Income:", scales::dollar(income * 100000)
    )
  )) +
  geom_point(aes(size = poverty), alpha = 0.7) +
  geom_errorbarh(
    aes(xmin = .lower, xmax = .upper),
    height = 0.002, alpha = 0.5
  ) +
  geom_abline(slope = 1, linetype = "dashed", color = "gray") +
  scale_color_viridis_c(option = "plasma", labels = scales::percent) +
  scale_size_continuous(
    range = c(1, 10),
    labels = scales::dollar_format(scale = 1e5)
  ) +
  labs(
    title = "Actual vs. Predicted Income Inequality in U.S",
    x = "Predicted Gini",
    y = "Actual Gini",
    color = "Unemp. Rate",
    size = "Poverty (Ã—$100K)",
    caption = "Data Source: ACS 2020"
  )

# 4. Convert to interactive plot
ggplotly(plot_interactive, tooltip = "text") |> 
  layout(hoverlabel = list(bgcolor = "white"))
```

<div style="text-align: justify;"> United Nation has set through SDG 10 to minimize gap of income inequality among people for sustainable development. Income inequality is burning issue for all nations around the globe. I have examined income inequality in U.S by using data from American Community Servey (ACS) 2020. Gini Index table has the data of income inequality, index value 0.4 and above means income inequality.
First, EDA was conducted. Then, liner regression model predicted the income inequality as function of income, poverty, and unemployment rate. The predictions are based upon some assumptions, if there is change in income, poverty and unemployment rate due to reforms or other opportunities, the actual results may vary. The income inequality (Gini Index) in U.S is predicted to be 0.48, with a 95% CI of 0.46 to 0.49 in most of the counties.</div>



